<app-layout>
  <div class="max-w-3xl mx-auto p-4 sm:p-6">
    <div
      class="bg-card border border-border rounded-lg p-4 shadow-md space-y-4 sm:rounded-xl sm:p-6 sm:shadow-lg sm:space-y-6"
    >
      <div class="flex items-center justify-between">
        <h1 class="text-xl font-bold text-text sm:text-2xl lg:text-3xl">
          {{ isEdit() ? 'Modifier la candidature' : 'Nouvelle candidature' }}
        </h1>
      </div>

      <form class="space-y-6 sm:space-y-8" [formGroup]="form" (ngSubmit)="submit()">
        <!-- Section 1: Informations gÃ©nÃ©rales -->
        <div class="space-y-4 sm:space-y-5">
          <div class="border-l-4 border-primary pl-4">
            <h2 class="text-base font-semibold text-text sm:text-lg">
              ğŸ“‹ Informations gÃ©nÃ©rales
            </h2>
            <p class="text-xs text-muted mt-1 sm:text-sm">
              DÃ©tails de l'offre d'emploi et de l'entreprise
            </p>
          </div>

          <div class="grid grid-cols-1 gap-4 sm:gap-5 md:grid-cols-2">
            <div class="space-y-1 sm:space-y-2">
              <label class="block text-xs font-medium text-text sm:text-sm"
              >Titre du poste recherchÃ© *</label
              >
              <input
                class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-primary focus:border-primary transition-all border-border bg-background text-text/50 text-sm sm:px-4 sm:py-3 sm:rounded-md sm:text-base"
                formControlName="title"
                placeholder="Ex: DÃ©veloppeur Full-Stack React/Node.js"
              />
              @if (form.get('title')?.errors && form.get('title')?.touched) {
                <p class="text-xs text-error mt-1">
                  Le titre du poste est requis (minimum 2 caractÃ¨res)
                </p>
              }
            </div>

            <div class="space-y-1 sm:space-y-2">
              <label class="block text-xs font-medium text-text sm:text-sm"
              >Nom de l'entreprise</label
              >
              <input
                class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-primary focus:border-primary transition-all border-border bg-background text-text/50 text-sm sm:px-4 sm:py-3 sm:rounded-md sm:text-base"
                formControlName="company"
                placeholder="Ex: Google, Airbnb, startup locale... (optionnel)"
              />
              <p class="text-xs text-muted">
                ğŸ’¡ Aide Ã  organiser vos candidatures par entreprise
              </p>
            </div>

            <div class="space-y-1 sm:space-y-2">
              <label class="block text-xs font-medium text-text sm:text-sm"
              >Lien vers l'offre d'emploi</label
              >
              <input
                class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-primary focus:border-primary transition-all border-border bg-background text-text/50 text-sm sm:px-4 sm:py-3 sm:rounded-md sm:text-base"
                formControlName="jobUrl"
                placeholder="https://linkedin.com/jobs/... (optionnel)"
              />
              <p class="text-xs text-muted">ğŸ”— Pour retrouver facilement l'offre originale</p>
            </div>

            <div class="space-y-1 sm:space-y-2">
              <label class="block text-xs font-medium text-text sm:text-sm"
              >Type de contrat</label
              >
              <select
                class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-primary focus:border-primary transition-all border-border bg-background text-text text-sm sm:px-4 sm:py-3 sm:rounded-md sm:text-base"
                formControlName="contractType"
              >
                <option value="">Non prÃ©cisÃ©</option>
                <option value="CDI">CDI - Contrat Ã  DurÃ©e IndÃ©terminÃ©e</option>
                <option value="CDD">CDD - Contrat Ã  DurÃ©e DÃ©terminÃ©e</option>
                <option value="INTERIM">IntÃ©rim - Mission temporaire</option>
                <option value="STAGE">Stage - Formation professionnelle</option>
                <option value="ALTERNANCE">Alternance - Formation en alternance</option>
                <option value="FREELANCE">Freelance - Mission indÃ©pendante</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Section 2: Suivi de candidature -->
        <div class="space-y-4 sm:space-y-5">
          <div class="border-l-4 border-accent pl-4">
            <h2 class="text-base font-semibold text-text sm:text-lg">
              ğŸ“Š Suivi de ma candidature
            </h2>
            <p class="text-xs text-muted mt-1 sm:text-sm">
              Statut actuel et planification des relances
            </p>
          </div>

          <div class="grid grid-cols-1 gap-4 sm:gap-5 md:grid-cols-2">
            <div class="space-y-1 sm:space-y-2">
              <label class="block text-xs font-medium text-text sm:text-sm"
              >OÃ¹ en est ma candidature ?</label
              >
              <select
                class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-primary focus:border-primary transition-all border-border bg-background text-text/50 text-sm sm:px-4 sm:py-3 sm:rounded-md sm:text-base"
                formControlName="status"
              >
                <option value="APPLIED">ğŸ“¤ Candidature envoyÃ©e - J'ai postulÃ©</option>
                <option value="PENDING">â³ En cours d'examen - Mon profil est Ã©tudiÃ©</option>
                <option value="INTERVIEW">ğŸ¤ Entretien - Ã‰change prÃ©vu ou passÃ©</option>
                <option value="ACCEPTED">ğŸ‰ AcceptÃ©e - Offre reÃ§ue ou poste obtenu</option>
                <option value="REJECTED">âŒ RefusÃ©e - Candidature non retenue</option>
              </select>
            </div>

            <div class="space-y-1 sm:space-y-2">
              <label class="block text-xs font-medium text-text sm:text-sm"
              >Date de ma candidature</label
              >
              <div class="relative">
                <input
                  type="date"
                  class="w-full pr-10 px-3 py-2 border rounded focus:ring-2 focus:ring-primary focus:border-primary transition-all border-border bg-background text-text text-sm sm:px-4 sm:py-3 sm:rounded-md sm:text-base"
                  formControlName="appliedAt"
                />
                <img
                  [ngSrc]="'/icons/calendar.svg'"
                  alt="calendrier"
                  class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 icon-invert"
                  width="24"
                  height="24"
                />
              </div>
              <p class="text-xs text-muted">ğŸ“… Pour calculer les rappels automatiques</p>
            </div>
          </div>

          <div class="bg-muted-50 border border-border rounded-lg p-4 space-y-3">
            <h3 class="text-sm font-medium text-text flex items-center gap-2">
              ğŸ”” Rappels automatiques
            </h3>
            <p class="text-xs text-muted">Choisissez la frÃ©quence de vos rappels de suivi :</p>

            <div class="grid grid-cols-1 gap-2 sm:grid-cols-2 md:grid-cols-4">
              @for (option of reminderOptions; track option.value) {
                <label
                  class="flex items-start space-x-2 p-2 border rounded cursor-pointer hover:bg-background transition-colors"
                  [class.border-primary]="form.get('frequency')?.value === option.value"
                  [class.bg-primary-50]="form.get('frequency')?.value === option.value"
                >
                  <input
                    type="radio"
                    [value]="option.value"
                    formControlName="frequency"
                    class="mt-0.5"
                  />
                  <div>
                    <div class="text-xs font-medium text-text">{{ option.label }}</div>
                    <div class="text-xs text-muted">{{ option.description }}</div>
                  </div>
                </label>
              }
            </div>

            <div class="text-xs text-muted bg-background border border-border rounded p-2">
              ğŸ’¡ <strong>Conseil :</strong> Un suivi rÃ©gulier augmente vos chances de rÃ©ponse.
              Nous vous enverrons un rappel par email.
            </div>
          </div>
        </div>

        <!-- Section 3: Notes personnelles -->
        <div class="space-y-4 sm:space-y-5">
          <div class="border-l-4 border-secondary pl-4">
            <h2 class="text-base font-semibold text-text sm:text-lg">
              ğŸ“ Mes notes personnelles
            </h2>
            <p class="text-xs text-muted mt-1 sm:text-sm">Informations importantes Ã  retenir</p>
          </div>

          <div class="space-y-1 sm:space-y-2">
            <label class="block text-xs font-medium text-text sm:text-sm"
            >Notes et remarques</label
            >
            <textarea
              rows="4"
              class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-primary focus:border-primary transition-all border-border bg-background text-text/50 text-sm sm:rows-5 sm:px-4 sm:py-3 sm:rounded-md sm:text-base"
              formControlName="notes"
              placeholder="Ex: Salaire discutÃ© 45-50k, contact RH sympathique, tÃ©lÃ©travail possible 2j/semaine, Ã©quipe de 8 dÃ©veloppeurs..."
            ></textarea>
            <p class="text-xs text-muted">
              ğŸ’­ Notez tout ce qui vous semble important : impressions, dÃ©tails du poste,
              Ã©changes avec le recruteur...
            </p>
          </div>
        </div>

        <div class="flex flex-col gap-2 pt-2 sm:flex-row sm:items-center sm:gap-3 sm:pt-0">
          <app-button
            [customClass]="'w-full sm:w-auto px-4 py-2 text-sm sm:px-6 sm:py-3 sm:text-base'"
            type="submit"
            color="primary"
            [isLoading]="submitting()"
            [disabled]="form.invalid || submitting()"
          >
            Enregistrer
          </app-button>
          <app-button
            [customClass]="'w-full sm:w-auto px-4 py-2 text-sm sm:px-6 sm:py-3 sm:text-base'"
            type="button"
            color="secondary"
            (buttonClick)="cancel()"
          >
            Annuler
          </app-button>
        </div>
      </form>
    </div>
  </div>
</app-layout>
