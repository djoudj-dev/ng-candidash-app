<div
  class="w-full max-w-sm mx-auto px-4 py-6 sm:max-w-md sm:px-6 sm:py-8 md:max-w-lg lg:max-w-xl xl:max-w-2xl"
>
  <div
    class="bg-surface border border-border rounded-lg p-6 shadow-sm sm:rounded-xl sm:p-8 md:shadow-lg"
  >
    <div class="text-center mb-6 sm:mb-8">
      <div class="flex justify-center mb-4">
        <div class="bg-primary/10 p-3 rounded-full">
          <img
            [ngSrc]="'/icons/lock.svg'"
            alt="cadenas"
            class="w-6 h-6 object-contain icon-invert"
            width="16"
            height="16"
            />
        </div>
      </div>
      <h2 class="text-2xl font-bold text-text sm:text-3xl md:text-4xl">Nouveau mot de passe</h2>
      <p class="text-muted mt-2 text-sm sm:text-base sm:mt-4">
        Choisissez un nouveau mot de passe sécurisé pour votre compte.
      </p>
    </div>

    @if (!passwordReset()) {
      <form
        [formGroup]="resetPasswordForm"
        (ngSubmit)="onSubmit()"
        class="space-y-4 sm:space-y-6"
      >
        <div class="space-y-1 sm:space-y-2">
          <label for="newPassword" class="block text-sm font-medium text-text sm:text-base">
            Nouveau mot de passe
          </label>
          <div class="relative">
            <input
              id="newPassword"
              [type]="showPassword() ? 'text' : 'password'"
              formControlName="newPassword"
              (input)="updateCurrentPassword()"
              class="w-full px-3 py-2 pr-10 border rounded-md bg-background text-text placeholder:text-muted focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-all duration-200 sm:px-4 sm:py-3 sm:pr-12 sm:rounded-lg"
              [class.border-error]="isFieldInvalid('newPassword')"
              [class.border-input]="!isFieldInvalid('newPassword')"
              placeholder="••••••••"
            />
            <button
              type="button"
              (click)="togglePasswordVisibility()"
              class="absolute right-2 top-1/2 -translate-y-1/2 text-muted hover:text-text transition-colors duration-200 hover:scale-110 sm:right-3"
              tabindex="-1"
            >
              <img [ngSrc]="showPassword() ? '/icons/eye.svg' : '/icons/eye-off.svg'" [attr.alt]="showPassword() ? 'Icône oeil ouvert' : 'Icône oeil fermé'" class="w-4 h-4 object-contain icon-invert sm:w-5 sm:h-5" width="16" height="16" />
            </button>
          </div>
          @if (newPasswordError()) {
            <p class="text-error text-xs mt-1 sm:text-sm">{{ newPasswordError() }}</p>
          }
        </div>

        <div class="space-y-1 sm:space-y-2">
          <label for="confirmPassword" class="block text-sm font-medium text-text sm:text-base">
            Confirmer le mot de passe
          </label>
          <div class="relative">
            <input
              id="confirmPassword"
              [type]="showConfirmPassword() ? 'text' : 'password'"
              formControlName="confirmPassword"
              class="w-full px-3 py-2 pr-10 border rounded-md bg-background text-text placeholder:text-muted focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-all duration-200 sm:px-4 sm:py-3 sm:pr-12 sm:rounded-lg"
              [class.border-error]="isFieldInvalid('confirmPassword')"
              [class.border-input]="!isFieldInvalid('confirmPassword')"
              placeholder="••••••••"
            />
            <button
              type="button"
              (click)="toggleConfirmPasswordVisibility()"
              class="absolute right-2 top-1/2 -translate-y-1/2 text-muted hover:text-text transition-colors duration-200 hover:scale-110 sm:right-3"
              tabindex="-1"
            >
              <img [ngSrc]="showConfirmPassword() ? '/icons/eye.svg' : '/icons/eye-off.svg'" [attr.alt]="showConfirmPassword() ? 'Icône oeil ouvert' : 'Icône oeil fermé'" class="w-4 h-4 object-contain icon-invert sm:w-5 sm:h-5" width="16" height="16" />
            </button>
          </div>
          @if (confirmPasswordError()) {
            <p class="text-error text-xs mt-1 sm:text-sm">{{ confirmPasswordError() }}</p>
          }
        </div>

        <!-- Indicateurs de sécurité du mot de passe -->
        <div class="space-y-2">
          <p class="text-xs font-medium text-muted">Le mot de passe doit contenir :</p>
          <div class="grid grid-cols-1 gap-1 text-xs sm:grid-cols-2">
            <div
              class="flex items-center gap-2"
              [class.text-success]="hasMinLength()"
              [class.text-muted]="!hasMinLength()"
            >
              <img [ngSrc]="hasMinLength() ? '/icons/check.svg' : '/icons/wrong.svg'" [attr.alt]="hasMinLength() ? 'Validé' : 'Non validé'" class="w-4 h-4 object-contain" width="12" height="12" />
              8 caractères minimum
            </div>
            <div
              class="flex items-center gap-2"
              [class.text-success]="hasUppercase()"
              [class.text-muted]="!hasUppercase()"
            >
              <img [ngSrc]="hasUppercase() ? '/icons/check.svg' : '/icons/wrong.svg'" [attr.alt]="hasUppercase() ? 'Validé' : 'Non validé'" class="w-4 h-4 object-contain" width="12" height="12" />
              Une majuscule
            </div>
            <div
              class="flex items-center gap-2"
              [class.text-success]="hasLowercase()"
              [class.text-muted]="!hasLowercase()"
            >
              <img [ngSrc]="hasLowercase() ? '/icons/check.svg' : '/icons/wrong.svg'" [attr.alt]="hasLowercase() ? 'Validé' : 'Non validé'" class="w-4 h-4 object-contain" width="12" height="12" />
              Une minuscule
            </div>
            <div
              class="flex items-center gap-2"
              [class.text-success]="hasNumber()"
              [class.text-muted]="!hasNumber()"
            >
              <img [ngSrc]="hasNumber() ? '/icons/check.svg' : '/icons/wrong.svg'" [attr.alt]="hasNumber() ? 'Validé' : 'Non validé'" class="w-4 h-4 object-contain" width="12" height="12" />
              Un chiffre
            </div>
            <div
              class="flex items-center gap-2 sm:col-span-2"
              [class.text-success]="hasSpecialChar()"
              [class.text-muted]="!hasSpecialChar()"
            >
              <img [ngSrc]="hasSpecialChar() ? '/icons/check.svg' : '/icons/wrong.svg'" [attr.alt]="hasSpecialChar() ? 'Validé' : 'Non validé'" class="w-4 h-4 object-contain" width="12" height="12" />
              Un caractère spécial (&#64;$!%*?&)
            </div>
          </div>
        </div>

        <app-button
          type="submit"
          color="primary"
          [disabled]="resetPasswordForm.invalid"
          [isLoading]="authService.isLoading()"
          customClass="w-full py-3 text-base font-semibold mt-6 sm:py-4 sm:text-lg sm:mt-8"
        >
          {{ submitLabel() }}
        </app-button>
      </form>
    } @else {
      <div class="text-center space-y-4">
        <div class="bg-success/10 border border-success/20 rounded-lg p-4">
          <div class="flex justify-center mb-3">
            <div class="bg-success/20 p-2 rounded-full">
              <img
                [ngSrc]="'/icons/check.svg'"
                alt="cadenas"
                class="w-6 h-6 object-contain icon-invert"
                width="16"
                height="16"
                />
            </div>
          </div>
          <h3 class="font-semibold text-success mb-2">Mot de passe mis à jour !</h3>
          <p class="text-success/80 text-sm mb-4">
            Votre mot de passe a été réinitialisé avec succès. Vous pouvez maintenant vous
            connecter avec votre nouveau mot de passe.
          </p>
          <app-button
            color="primary"
            customClass="w-full py-2 text-sm sm:w-auto sm:px-6"
            (buttonClick)="navigateToSignin()"
          >
            Se connecter
          </app-button>
        </div>
      </div>
    }

    @if (!passwordReset()) {
      <div class="mt-6 text-center sm:mt-8">
        <button
          type="button"
          (click)="navigateToSignin()"
          class="text-muted hover:text-text font-medium text-sm transition-colors duration-200 underline-offset-4 hover:underline flex items-center justify-center gap-2"
        >
          <img
          [ngSrc]="'/icons/arrow-left.svg'"
          alt="fleche vers la gauche"
          class="w-4 h-4 object-contain icon-invert"
          width="16"
          height="16"
          />
          Retour à la connexion
        </button>
      </div>
    }
  </div>
</div>
